{% load i18n %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% trans "Admin Dashboard" %}</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    :root{
      --status-success: #198754; /* green */
      --status-cancelled: #dc3545; /* red */
      --status-failed: #212529; /* black */
      --status-waiting: #ffc107; /* yellow */
    }
    .status-badge{ font-size:.85rem; }
    .status-success{ background: var(--status-success); color:#fff; }
    .status-cancelled{ background: var(--status-cancelled); color:#fff; }
    .status-failed{ background: var(--status-failed); color:#fff; }
    .status-waiting{ background: var(--status-waiting); color:#212529; }
    .table-responsive{ overflow-x:auto; }
    .tx-row{ cursor: pointer; }
    @media (max-width: 576px){
      .table thead{ display:none; }
      .table tr{ display:block; margin-bottom: .75rem; border:1px solid #eee; border-radius:.5rem; padding:.5rem; }
      .table td{ display:flex; justify-content:space-between; align-items:center; padding:.25rem .5rem; }
      .table td::before{ content: attr(data-label); font-weight:600; margin-right:.75rem; }
      .tx-row{ cursor:auto; }
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4 mb-0">{% trans "Transactions" %}</h1>
      <a class="btn btn-sm btn-secondary" href="/admin/">{% trans "Admin" %}</a>
    </div>

    <div class="table-responsive">
      <table class="table table-sm align-middle bg-white">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>{% trans "Order" %}</th>
            <th>{% trans "Customer" %}</th>
            <th>{% trans "Amount" %}</th>
            <th>{% trans "Currency" %}</th>
            <th>{% trans "Status" %}</th>
            <th>{% trans "Paid At" %}</th>
            <th>{% trans "Actions" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for tx in page_obj.object_list %}
            {% with order=tx.order %}
              <tr class="tx-row">
                <td data-label="ID">{{ tx.id }}</td>
                <td data-label="Order"><a href="{% url 'orders:dashboard_order_detail' order.id %}">{{ order.id }}</a></td>
                <td data-label="Customer">{{ order.first_name }} {{ order.last_name }}</td>
                <td data-label="Amount">{{ order.total_price }}</td>
                <td data-label="Currency">{{ order.currency }}</td>
                <td data-label="Status">
                  <span class="badge status-badge {% if tx.status == 'success' %}status-success{% elif tx.status == 'cancelled' %}status-cancelled{% elif tx.status == 'failed' %}status-failed{% else %}status-waiting{% endif %}">
                    {{ tx.get_status_display }}
                  </span>
                </td>
                <td data-label="Paid At">{{ tx.payment_time|date:"Y-m-d H:i" }}</td>
                <td data-label="Actions">
                  <a class="btn btn-sm btn-outline-primary" href="{% url 'orders:dashboard_order_detail' order.id %}">{% trans "Details" %}</a>
                </td>
              </tr>
            {% endwith %}
          {% empty %}
            <tr><td colspan="8" class="text-center text-muted py-4">{% trans "No transactions found" %}</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if paginator.num_pages > 1 %}
      <nav aria-label="Pagination" class="mt-3">
        <ul class="pagination pagination-sm justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
          {% endif %}

          {% for num in paginator.page_range %}
            <li class="page-item {% if page_obj.number == num %}active{% endif %}">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>
</body>
</html>
